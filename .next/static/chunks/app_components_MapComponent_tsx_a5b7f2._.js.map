{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/kiba/Desktop/projet-tw/app/components/MapComponent.tsx"],"sourcesContent":["//ça dit a Node que la carte doit être rendue côté client\n'use client';\n\nimport { useEffect, useRef, forwardRef, useImperativeHandle } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\n// Configuration des icônes personnalisées pour Leaflet\nconst defaultIcon = L.icon({\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\nconst selectedIcon = L.icon({\n  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',\n  iconRetinaUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\n// Types\nexport interface Logement {\n  id: string;\n  title: string;\n  location: string;\n  price: number;\n  surface: number;\n  rooms: number;\n  image: string;\n  isFavorite: boolean;\n  coordinates: {\n    lat: number;\n    lng: number;\n  };\n}\n\ninterface MapComponentProps {\n  logements: Logement[];\n  center: {\n    lat: number;\n    lng: number;\n  };\n  selectedLogement: string | null;\n  onMarkerClick: (logementId: string) => void;\n}\n\n// Définition des méthodes accessibles via la ref\nexport interface MapComponentRef {\n  flyTo: (latlng: [number, number], zoom: number, options?: L.ZoomPanOptions) => void;\n}\n\nconst MapComponent = forwardRef<MapComponentRef, MapComponentProps>(({ \n  logements, \n  center, \n  selectedLogement,\n  onMarkerClick \n}, ref) => {\n  const mapRef = useRef<L.Map | null>(null);\n  const markersRef = useRef<{[key: string]: L.Marker}>({});\n\n  // Exposer des méthodes via la ref\n  useImperativeHandle(ref, () => ({\n    flyTo: (latlng: [number, number], zoom: number, options?: L.ZoomPanOptions) => {\n      if (mapRef.current) {\n        mapRef.current.flyTo(latlng, zoom, options);\n      }\n    }\n  }));\n\n  useEffect(() => {\n    // Ne s'exécute que côté client\n    if (typeof window === 'undefined') return;\n\n    // Initialiser la carte\n    if (!mapRef.current) {\n      mapRef.current = L.map('map').setView([center.lat, center.lng], 6);\n      \n      // Ajouter la couche de tuiles OpenStreetMap\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n        maxZoom: 19,\n      }).addTo(mapRef.current);\n    }\n\n    // Nettoyer les marqueurs existants\n    Object.values(markersRef.current).forEach(marker => {\n      if (marker && mapRef.current) {\n        marker.removeFrom(mapRef.current);\n      }\n    });\n    markersRef.current = {};\n\n    // Ajouter les marqueurs pour chaque logement\n    logements.forEach(logement => {\n      if (!mapRef.current) return;\n      \n      const marker = L.marker(\n        [logement.coordinates.lat, logement.coordinates.lng],\n        {\n          icon: logement.id === selectedLogement ? selectedIcon : defaultIcon,\n          title: logement.title\n        }\n      );\n\n      // Ajouter un popup avec les informations du logement\n      const popupContent = `\n        <div class=\"p-2\">\n          <img src=\"${logement.image}\" alt=\"${logement.title}\" class=\"w-full h-24 object-cover mb-2 rounded\">\n          <h3 class=\"font-bold\">${logement.title}</h3>\n          <p>${logement.location}</p>\n          <p class=\"text-blue-600 font-semibold\">${logement.price.toLocaleString()} €</p>\n          <p>${logement.surface} m² • ${logement.rooms} pièce${logement.rooms > 1 ? 's' : ''}</p>\n        </div>\n      `;\n\n      // Utiliser le popupContent déjà défini plus haut\n      marker.bindPopup(popupContent);\n      marker.addTo(mapRef.current);\n\n      // Ajouter un événement de clic pour le marqueur\n      marker.on('click', () => {\n        onMarkerClick(logement.id);\n      }); \n\n      // Stocker la référence du marqueur\n      markersRef.current[logement.id] = marker;\n    });\n\n    // Ajuster la vue pour afficher tous les marqueurs si nécessaire\n    if (logements.length > 0 && !selectedLogement && mapRef.current) {\n      const markers = Object.values(markersRef.current).filter(Boolean) as L.Marker[];\n      if (markers.length > 0) {\n        // Créer un tableau de coordonnées des marqueurs\n        const latLngs = markers.map(marker => marker.getLatLng());\n        if (latLngs.length > 0) {\n          // Créer un bounds à partir des coordonnées avec une syntaxe compatible TypeScript\n          const bounds = latLngs.reduce(\n            (bounds, latlng) => bounds.extend(latlng),\n            L.latLngBounds([latLngs[0], latLngs[0]])\n          );\n          // Ajuster la vue pour afficher tous les marqueurs avec un peu de marge\n          mapRef.current.fitBounds(bounds.pad(0.1));\n        }\n      }\n    }\n\n    // Nettoyage\n    return () => {\n      if (mapRef.current) {\n        mapRef.current.remove();\n        mapRef.current = null;\n      }\n    };\n  }, [logements, selectedLogement, center.lat, center.lng, onMarkerClick]);\n\n  return <div id=\"map\" style={{ height: '100%', width: '100%' }} />;\n});\n\nMapComponent.displayName = 'MapComponent';\n\nexport default MapComponent;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}